Usefull services for integration Newscoop and Facebook.

### Features

 * Facebook caches shared urls for better performance. It can cause some problems at the time we want to change title, decscripton of our article because we still have an older version of our article. Plugin allows you easly clear cached by Facebook data.
 * Plugin provide also easy way to generate all required og tags with simple template block.
 * Newscoop provide easy way to scheduled articles publication, but before publishing article you can't plan it on Facebook - he will don't fetch article metadata. This plugin expose special url for Facebook crawler for planing posts with scheduled articles. This link will redirect all users to real articles when article will be already published.


Installing Newscoop Facebook Plugin Guide
-------------
Installation is a quick process:


1. Installing plugin through our Newscoop Plugin System
2. That's all!

### Step 1: Installing plugin through our Newscoop Plugin System
Run the command:
``` bash
$ php application/console plugins:install "newscoop/facebook-newscoop-bundle" --env=prod
```
Plugin will be installed to your project's `newscoop/plugins/Newscoop` directory.


### Step 2: That's all!
Go to an article edition in Newscoop to see Newscoop Facebook Plugin on the right sidebar in action.

Also read more about [Lifecycle Subscriber Managing](https://wiki.sourcefabric.org/display/NPS/Lifecycle+Subscriber+Managing).

###More about plugin 


Plugin has only one Entity: `Facebook.php`. After plugin is installed in your database will show up new table: `plugin_facebook_informations`.

This table keeps informations from Facebook about an article, such a:
- `article` - article ID
- `language` - article's language ID
- `title` - article title
- `description` - article description
- `created_at` - date when informations were added
- `is_active` - informations status

**Generating Open Graph tags using Smarty Plugin**

In `Newscoop/FacebookNewscoopBundle/Resources/smartyPlugins` directory you will find file called: `block.facebook_meta_block.php`

This file is facebook metadata block plugin. It generates the Facebook Meta information for a page.

Smarty Plugin will be automatically autoloaded and available in your templates.

To test and display meta data generated by smarty plugin just put this block:
````
{{ facebook_meta_block admins="123422,234223432,234234234,23423423" }}{{ /facebook_meta_block }}
````
 into `_html-head.tpl`

Smarty plugin will generate HTML code:

```
//ex.
<meta property="og:title" content="Lionel Messi: the Argentinean who makes children dream all over the world" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http:/newscoop.dev/en/may2013/sports/80/Lionel-Messi-the-Argentinean-who-makes-children-dream-all-over-the-world.htm" />
<meta property="og:site_name" content="The New Custodian" />
<meta property="og:locale" content="en" />
<meta property="og:description" content="Malorum prompta maiestatis ius at, vim movet cotidieque ei. Erroribus torquatos vel et, pri nostro causae gubergren id. Per ut cetero laoreet recteque, cetero lucilius phaedrum his at" />
<meta property="article:section" content="Sports" />
<meta property="article:author" content="Amerigo Vespucci" />
<meta property="article:published_time" content="2013-05-02 08:17:08" />
<meta property="fb:app_id" content="499467366771848" />
<meta property="fb:admins" content="123422,234223432,234234234,23423423" />
<meta property="og:image" content="http://newscoop.dev/images/cms-image-000000124.jpg" />
```

More about Open Graph tags [here](https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/).

**Scheduling (submited and scheduled for publication in Newscoop) articles on Facebok**

Plugin provides special route for articles witch can be used for planning not yet published articles. 

Uri have this format: ```/f/+{webcode}``` for example: ```/f/+j6gd4``` and can be found on plugin sidebar widget in article editor.

![Screen](http://i58.tinypic.com/2rzyp2t.png)

By default only simple html structure with og meta tags will be rendered for Facebook crawler. You can override it with ```__fb_submited_article.tpl``` template file in your template.

Example template output:
```
<!DOCTYPE html>
<html xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
    <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>test article</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
        <meta name="description" content="">
        <meta name="keywords" content="" />
        <meta property="og:title" content="test article" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="http://newscoop.dev/en/2/2/130/" />
        <meta property="og:site_name" content="test publication" />
        <meta property="og:description" content="" />
        <meta property="article:section" content="police" />
        <meta property="og:image" content="http://newscoop.dev/images/cms-image-000000011.jpg" />
        <meta property="article:publisher" content="https://www.facebook.com/newscoop.dev" />
        <meta property="og:author" content="http://facebook.com/newscoop.dev" />
        <meta name="author" content="test publication" />
    </head>
</html>

```


Plugin in action:
-------
When you enter an article edition in Newscoop, plugin will automatically look into database and check if there are already informations about that article, if not then it will connect to Facebook Graph API and download all necessary informations. Next, informations will be inserted into database.


To simply clear article cache on Facebook, just click `Clear article cache on Facebook` button.
After you click It, proper message will show up (look at **Screen 2**).

If connection to Facebook success, status message on **Screen 1** will show up.

If for some reasons connection to Facebook won't be possible, we will see error message (look at **Screen 3**)

![Screen 1](http://i42.tinypic.com/30k65x0.png)

**Screen 1:** General Plugin view.

![Screen 2](http://i42.tinypic.com/2qve24x.png)
**Screen 2:** Connecting message after button click.

![Screen 3](http://i42.tinypic.com/6tp9nl.png)
**Screen 3:** Connection to Facebook failed - status message.


License
-------

This bundle is under the GNU GPL v.3. See the complete license in the bundle: [LICENSE.txt](https://raw.github.com/newscoop/plugin-NewscoopFacebook/master/LICENSE.txt)

About
-------
FacebookNewscoopBundle is a [Sourcefabric o.p.s](https://github.com/sourcefabric) initiative.